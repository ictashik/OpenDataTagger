{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-primary">Define Input & Output Columns</h1>
    <p class="text-muted">Select input columns and define how AI should generate outputs.</p>

    <div class="card p-4 mt-3 shadow">
        <form method="post">
            {% csrf_token %}

            <!-- Input Columns Section -->
            <h4 class="mb-3 text-info">Select Input Columns</h4>
            {% for column in columns %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="input_columns" value="{{ column }}" 
                           id="input_{{ column }}" {% if column in request.session.input_columns %}checked{% endif %}>
                    <label class="form-check-label" for="input_{{ column }}">
                        {{ column }}
                    </label>
                </div>
            {% endfor %}

            <hr>

            <!-- Output Columns Section -->
            <h4 class="mb-3 text-warning">Define Output Columns & Prompts</h4>
            <div id="output-column-container">
                {% for entry in config_data %}
                    <div class="output-column mb-3">
                        <div class="input-group">
                            <input type="text" name="output_column" class="form-control" value="{{ entry.OutputColumn }}" placeholder="Column Name" required>
                            <input type="text" name="prompt_template" class="form-control" value="{{ entry.PromptTemplate }}" placeholder="Prompt (e.g., Check if food is veg or non-veg)" required>
                            <button type="button" class="btn btn-danger remove-column">X</button>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Add Output Column Button -->
            <button type="button" class="btn btn-outline-success w-100 mt-3" id="add-output-column">+ Add Output Column</button>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100 mt-4">Save & Continue</button>
        </form>
    </div>
</div>

<script>
    document.getElementById("add-output-column").addEventListener("click", function () {
        let container = document.getElementById("output-column-container");
        let newField = document.createElement("div");
        newField.classList.add("output-column", "mb-3");
        newField.innerHTML = `
            <div class="input-group">
                <input type="text" name="output_column" class="form-control" placeholder="Column Name" required>
                <input type="text" name="prompt_template" class="form-control" placeholder="Prompt (e.g., Check if food is veg or non-veg)" required>
                <button type="button" class="btn btn-danger remove-column">X</button>
            </div>
        `;
        container.appendChild(newField);

        // Attach event listener to remove buttons
        attachRemoveEvent();
    });

    function attachRemoveEvent() {
        let removeButtons = document.querySelectorAll(".remove-column");
        removeButtons.forEach(button => {
            button.onclick = function () {
                this.parentElement.parentElement.remove();
            };
        });
    }

    // Ensure remove buttons work for initial fields
    attachRemoveEvent();
</script>

{% endblock %}